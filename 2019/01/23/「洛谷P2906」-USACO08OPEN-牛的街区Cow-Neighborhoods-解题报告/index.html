<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>「洛谷P2906」[USACO08OPEN]牛的街区Cow Neighborhoods 解题报告 | Hello,I am louhc</title>
  <meta name="author" content="louhc">
  
  <meta name="description" content="P2906 [USACO08OPEN]牛的街区Cow Neighborhoods题目描述Those Who Know About Cows are aware of the way cows group into ‘Cow Neighborhoods’. They have observed Farmer John’s N (1 &amp;lt;= N &amp;lt;= 100,000) cows (conveniently numbered 1..N) as they graze, each at her own unique integer rectilinear coordinate, on a pasture whose X and Y coordinates are in the range 1..1,000,000,000.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="「洛谷P2906」[USACO08OPEN]牛的街区Cow Neighborhoods 解题报告">
  <meta property="og:site_name" content="Hello,I am louhc">

  
    <meta property="og:image" content="">
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Hello,I am louhc" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>
</html>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Hello,I am louhc</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2019-01-23T00:07:17.000Z"><a href="/2019/01/23/「洛谷P2906」-USACO08OPEN-牛的街区Cow-Neighborhoods-解题报告/">2019-01-23</a></time>
      
      
  
    <h1 class="title">「洛谷P2906」[USACO08OPEN]牛的街区Cow Neighborhoods 解题报告</h1>
  

    </header>
    <div class="entry">
      
        <h1 id="P2906-USACO08OPEN-牛的街区Cow-Neighborhoods"><a href="#P2906-USACO08OPEN-牛的街区Cow-Neighborhoods" class="headerlink" title="P2906 [USACO08OPEN]牛的街区Cow Neighborhoods"></a><a href="https://www.luogu.org/problemnew/show/P2906" target="_blank" rel="noopener">P2906 [USACO08OPEN]牛的街区Cow Neighborhoods</a></h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>Those Who Know About Cows are aware of the way cows group into ‘Cow Neighborhoods’. They have observed Farmer John’s N (1 &lt;= N &lt;= 100,000) cows (conveniently numbered 1..N) as they graze, each at her own unique integer rectilinear coordinate, on a pasture whose X and Y coordinates are in the range 1..1,000,000,000.</p>
<a id="more"></a>
<p>Two cows are neighbors if at least one of two criteria is met:</p>
<p>1) If the cows are no further than some integer Manhattan distance C (1 &lt;= C &lt;= 1,000,000,000) apart, they are neighbors. [Manhattan distance is calculated as d = |x1-x2| + |y1-y2|.] 2) If cow A is a neighbor of cow Z and cow B is a neighbor of cow Z, then cow A is a neighbor of cow B (the ‘transitive closure of neighbors’).</p>
<p>Given the locations of the cows and the distance C, determine the the number of neighborhoods and the number of cows in the largest neighborhood.</p>
<p>By way of example, consider the pasture below. When C = 4, this pasture has four neighborhoods: a big one on the left, two neighborhoods of size 1 (the lonesome cows), and a huge neighborhood on the right with 60 different cows.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.....................................*................. </span><br><span class="line">....*...*..*.......................***................. </span><br><span class="line">......*...........................****................. </span><br><span class="line">..*....*..*.......................*...*.******.*.*..... </span><br><span class="line">........................*.............***...***...*.... </span><br><span class="line">*..*..*...*..........................*..*...*..*...*... </span><br><span class="line">.....................................*..*...*..*....... </span><br><span class="line">.....................................*..*...*..*....... </span><br><span class="line">...*................*.................................. </span><br><span class="line">.*..*............................*.*.*.*.*.*.*.*.*.*.*. </span><br><span class="line">.*.....*..........................*.*.*.*.*.*.*.*.*.*.* </span><br><span class="line">....*..................................................</span><br></pre></td></tr></table></figure>
<p>The input file describes cow locations by integer X,Y coordinates, where the lower left corner is (1,1) and cows close to that corner appear at both (2,2) and (5,1) in the example above.</p>
<p>For a given pasture, determine both the number of cow neighborhoods and the number of cows resident in the largest cow neighborhood.</p>
<p>The above picture is sample test case 2, which will be evaluated for you upon submission.</p>
<p>Partial feedback for some test cases will be provided on the first 10 submissions.</p>
<p>Time Limit: 2 seconds</p>
<p>Memory Limit: 32MB</p>
<p>了解奶牛们的人都知道，奶牛喜欢成群结队．观察约翰的N(1≤N≤100000)只奶牛，你会发现她们已经结成了几个“群”．每只奶牛在吃草的时候有一个独一无二的位置坐标$X_i$,$Y_i$($1\leq X_i,Y_i\leq [1 \cdots 10^9]$；$X_i,Y_i \in \text{整数}$．当满足下列两个条件之一，两只奶牛i和j是属于同一个群的：</p>
<ol>
<li><p>两只奶牛的曼哈顿距离不超过$C(1\leq C\leq 10^9)$，即$|X_i - x_i|+|Y_i - y_i|\leq C$.</p>
</li>
<li><p>两只奶牛有共同的邻居．即，存在一只奶牛$k$，使$i$与$k$，$j$与$k$均同属一个群．</p>
</li>
</ol>
<p>给出奶牛们的位置，请计算草原上有多少个牛群，以及最大的牛群里有多少奶牛</p>
<h2 id="输入输出格式"><a href="#输入输出格式" class="headerlink" title="输入输出格式"></a>输入输出格式</h2><h3 id="输入格式："><a href="#输入格式：" class="headerlink" title="输入格式："></a>输入格式：</h3><p>* Line 1: Two space-separated integers: N and C</p>
<p>* Lines 2..N+1: Line i+1 describes cow i’s location with two</p>
<p>space-separated integers: $X_i$ and $Y_i$</p>
<h3 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h3><p>* Line 1: A single line with a two space-separated integers: the number of cow neighborhoods and the size of the largest cow neighborhood.</p>
<h2 id="输入输出样例"><a href="#输入输出样例" class="headerlink" title="输入输出样例"></a>输入输出样例</h2><h3 id="输入样例-1："><a href="#输入样例-1：" class="headerlink" title="输入样例#1："></a>输入样例#1：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4 2 </span><br><span class="line">1 1 </span><br><span class="line">3 3 </span><br><span class="line">2 2 </span><br><span class="line">10 10</span><br></pre></td></tr></table></figure>
<h3 id="输出样例-1："><a href="#输出样例-1：" class="headerlink" title="输出样例#1："></a>输出样例#1：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2 3</span><br></pre></td></tr></table></figure>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>There are 2 neighborhoods, one formed by the first three cows and the other being the last cow. The largest neighborhood therefore has size 3.</p>
<hr>
<h1 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h1><p>有思考深度的好题呀！（注意下$X_i$与$x_i$表示的意义是不同的</p>
<p>我们观察两个点$i$、$j$的曼哈顿距离$|X_i-X_j|+|Y_i-Y_j|$。</p>
<ul>
<li><p>如果$X_i-X_j$与$Y_i-Y_j$同号，曼哈顿距离为$|X_i+Y_i-(X_j+Y_j)|$，且$|X_i-Y_i-(X_j-Y_j)|$偏小</p>
</li>
<li><p>如果异号，曼哈顿距离为$|X_i-Y_i-(X_j-Y_j)|$，且$|X_i+Y_i-(X_j+Y_j)|$偏小</p>
</li>
</ul>
<p>因此，我们发现，如果设$x_i=X_i+Y_i$，$y_i=X_i-Y_i$，$i$、$j$之间的曼哈顿距离即为$\max(|x_i-x_j|,|y_i-y_j|)$</p>
<p>然后用<del>平衡树</del>multiset一通乱搞就可以啦！</p>
<p>我们按照$x_i$为第一关键字，$y_i$为第二关键字排序，依次处理每个点。设当前处理的点为$i$。我们用并查集维护一个个群。</p>
<p>首先把所有$x$值小于$x_i-C$的点全部$erase$（删除）掉。</p>
<p>寻找第一个大于等于$y_i$的点$j$(lower_bound)。如果$y_j-y_i\le C$，很明显，$j$与$i$是同一个群的。</p>
<p>但是如果还有大于$y_i$的点$k$也满足条件呢？很明显，如果$y_k-y_i\le C$，那么$y_k-y_j\le y_k-y_i\le C$，在处理$j$或$k$的时候已经将它们合并（这取决于$x$的大小），不必再管。</p>
<p>然后再康康小于$y_i$的点有没有符合条件的就好啦！</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IT multiset<span class="meta-string">&lt;pi&gt;::iterator</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAXN 100005</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LL long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pi pair<span class="meta-string">&lt;LL, int&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> x, y;</span><br><span class="line">	<span class="keyword">bool</span> <span class="keyword">operator</span> &lt; ( <span class="keyword">const</span> node &amp;t )<span class="keyword">const</span>&#123;<span class="comment">//重载运算符</span></span><br><span class="line">		<span class="keyword">if</span> ( x == t.x ) <span class="keyword">return</span> y &lt; t.y;</span><br><span class="line">		<span class="keyword">return</span> x &lt; t.x;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="built_in">scanf</span>( <span class="string">"%d%d"</span>, &amp;x, &amp;y );</span><br><span class="line">		x = x + y, y = x - y - y;<span class="comment">//读入并把X、Y转换成x、y</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;a[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="built_in">multiset</span>&lt;pi&gt; s;<span class="comment">//因为要合并，还得记录编号（排序后的）。。所以用了个pair</span></span><br><span class="line">IT p[MAXN];<span class="comment">//迭代器数组，用于删除x过小的元素</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> f[MAXN], sm[MAXN];<span class="comment">//并查集、记录每个群的牛数（最后再处理</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">find</span><span class="params">( <span class="keyword">int</span> x )</span></span>&#123; <span class="keyword">return</span> x == f[x] ? x : ( f[x] = find(f[x]) ); &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Merge</span><span class="params">( <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span>&#123;</span><br><span class="line">	x = find(x); y = find(y);</span><br><span class="line">	f[x] = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> N, C, x, y;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>( <span class="string">"%d%d"</span>, &amp;N, &amp;C );</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; ++i ) a[i].input(), f[i] = i;</span><br><span class="line">	sort( a + <span class="number">1</span>, a + N + <span class="number">1</span> );</span><br><span class="line">	s.insert( make_pair( <span class="number">1l</span>l &lt;&lt; <span class="number">60</span>, <span class="number">-1</span> ) ); s.insert( make_pair( -( <span class="number">1l</span>l &lt;&lt; <span class="number">60</span> ), <span class="number">-1</span> ) );<span class="comment">//避免边界问题</span></span><br><span class="line">	p[<span class="number">1</span>] = s.insert(make_pair( a[<span class="number">1</span>].y, <span class="number">1</span> )); <span class="function"><span class="keyword">int</span> <span class="title">tmp</span><span class="params">(<span class="number">1</span>)</span></span>;<span class="comment">//第一个点直接插入即可。</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= N; ++i )&#123;</span><br><span class="line">		<span class="keyword">while</span>( a[i].x - a[tmp].x &gt; C ) s.erase(p[tmp++]);<span class="comment">//把不满足要求的点删除</span></span><br><span class="line">		</span><br><span class="line">		<span class="function">IT <span class="title">t</span><span class="params">(s.lower_bound(make_pair( a[i].y, <span class="number">-1</span> )))</span></span>;<span class="comment">//找第一个大于等于y的</span></span><br><span class="line">		<span class="keyword">if</span> ( t-&gt;first - a[i].y &lt;= C ) Merge( i, t-&gt;second );<span class="comment">//满足要求，合并</span></span><br><span class="line">		t--;<span class="comment">//找第一个小于y的</span></span><br><span class="line">		<span class="keyword">if</span> ( a[i].y - t-&gt;first &lt;= C ) Merge( i, t-&gt;second );<span class="comment">//满足要求，合并</span></span><br><span class="line">		</span><br><span class="line">		p[i] = s.insert( make_pair( a[i].y, i ) );<span class="comment">//插入点并记录迭代器</span></span><br><span class="line">	&#125;</span><br><span class="line">	int ans1(0), ans2(0);</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; ++i )&#123;</span><br><span class="line">		<span class="keyword">if</span> ( find(i) == i ) ans1++;</span><br><span class="line">		ans2 = max( ans2, ++sm[find(i)] );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>( <span class="string">"%d %d\n"</span>, ans1, ans2 );</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/神仙题/">神仙题</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="https://louhc.github.io/2019/01/23/「洛谷P2906」-USACO08OPEN-牛的街区Cow-Neighborhoods-解题报告/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:louhc.github.io">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/KMP/">KMP</a><small>1</small></li>
  
    <li><a href="/tags/NOIP/">NOIP</a><small>1</small></li>
  
    <li><a href="/tags/STL/">STL</a><small>1</small></li>
  
    <li><a href="/tags/ST表/">ST表</a><small>1</small></li>
  
    <li><a href="/tags/二分答案/">二分答案</a><small>2</small></li>
  
    <li><a href="/tags/分块/">分块</a><small>11</small></li>
  
    <li><a href="/tags/割点/">割点</a><small>2</small></li>
  
    <li><a href="/tags/博弈论/">博弈论</a><small>1</small></li>
  
    <li><a href="/tags/学习笔记/">学习笔记</a><small>6</small></li>
  
    <li><a href="/tags/并查集/">并查集</a><small>1</small></li>
  
    <li><a href="/tags/归并排序/">归并排序</a><small>1</small></li>
  
    <li><a href="/tags/技巧/">技巧</a><small>1</small></li>
  
    <li><a href="/tags/排序/">排序</a><small>1</small></li>
  
    <li><a href="/tags/搜索/">搜索</a><small>5</small></li>
  
    <li><a href="/tags/数学-数论/">数学,数论</a><small>5</small></li>
  
    <li><a href="/tags/暴力/">暴力</a><small>1</small></li>
  
    <li><a href="/tags/最短路/">最短路</a><small>2</small></li>
  
    <li><a href="/tags/期望-概率/">期望,概率</a><small>1</small></li>
  
    <li><a href="/tags/欧拉回路/">欧拉回路</a><small>1</small></li>
  
    <li><a href="/tags/水题/">水题</a><small>1</small></li>
  
    <li><a href="/tags/深搜/">深搜</a><small>1</small></li>
  
    <li><a href="/tags/神仙题/">神仙题</a><small>2</small></li>
  
    <li><a href="/tags/线性DP/">线性DP</a><small>2</small></li>
  
    <li><a href="/tags/缩点/">缩点</a><small>1</small></li>
  
    <li><a href="/tags/网络流/">网络流</a><small>7</small></li>
  
    <li><a href="/tags/背包DP/">背包DP</a><small>2</small></li>
  
    <li><a href="/tags/质数/">质数</a><small>1</small></li>
  
    <li><a href="/tags/贪心/">贪心</a><small>3</small></li>
  
    <li><a href="/tags/递推/">递推</a><small>1</small></li>
  
    <li><a href="/tags/黑科技/">黑科技</a><small>3</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2019 louhc
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<!--<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>
